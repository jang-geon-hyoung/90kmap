<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>90K Map</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px;
    }
    #map-container {
      position: relative;
      width: 600px;
      height: 600px;
      background-image: url('map.png');
      background-size: cover;
      border: 2px solid #333;
    }
    .marker {
      position: absolute;
      color: white;
      font-size: 12px;
      padding: 2px 4px;
      border-radius: 6px;
      transform: translate(-50%, -100%);
      white-space: nowrap;
      cursor: pointer;
    }
    form {
      margin-top: 20px;
    }
    input, select {
      margin: 0 5px;
      padding: 5px;
    }
    button {
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>90K MAP</h1>

  <div id="map-container"></div>

  <form id="marker-form">
    이름: <input type="text" id="name" required />
    X: <input type="number" id="x" min="0" max="600" required />
    Y: <input type="number" id="y" min="0" max="600" required />
    색상:
    <input type="color" id="color" value="#ff0000" />
    <button type="submit">추가</button>
  </form>

  <script>
    const form = document.getElementById('marker-form');
    const map = document.getElementById('map-container');

    const savedMarkers = JSON.parse(localStorage.getItem('markers') || '[]');
    savedMarkers.forEach(drawMarker);

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const x = parseInt(document.getElementById('x').value);
      const y = parseInt(document.getElementById('y').value);
      const color = document.getElementById('color').value;

      if (x < 0 || x > 600 || y < 0 || y > 600) {
        alert("좌표는 0~600 사이여야 합니다.");
        return;
      }

      const markerData = { name, x, y, color };
      drawMarker(markerData);
      saveMarker(markerData);
      form.reset();
    });

    function drawMarker({ name, x, y, color }) {
      const marker = document.createElement('div');
      marker.className = 'marker';
      marker.style.left = x + 'px';
      marker.style.top = y + 'px';
      marker.style.backgroundColor = color;
      marker.textContent = name;
      marker.title = '클릭하면 삭제됩니다';

      marker.addEventListener('click', () => {
        if (confirm(`'${name}' 마커를 삭제할까요?`)) {
          marker.remove();
          deleteMarker(name, x, y);
        }
      });

      map.appendChild(marker);
    }

    function saveMarker(marker) {
      const markers = JSON.parse(localStorage.getItem('markers') || '[]');
      markers.push(marker);
      localStorage.setItem('markers', JSON.stringify(markers));
    }

    function deleteMarker(name, x, y) {
      let markers = JSON.parse(localStorage.getItem('markers') || '[]');
      markers = markers.filter(m => !(m.name === name && m.x === x && m.y === y));
      localStorage.setItem('markers', JSON.stringify(markers));
    }

    // 지도 클릭 시 좌표 자동 입력
    map.addEventListener('click', (e) => {
      const rect = map.getBoundingClientRect();
      const x = Math.floor(e.clientX - rect.left);
      const y = Math.floor(e.clientY - rect.top);
      document.getElementById('x').value = x;
      document.getElementById('y').value = y;
    });
  </script>
</body>
</html>

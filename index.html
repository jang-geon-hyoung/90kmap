<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>90K Map Marker Test</title>
<style>
  body {
    font-family: sans-serif;
    margin: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #map-container {
    position: relative;
    width: 600px;
    height: 600px;
    background-image: url('map.png');
    background-size: cover;
    border: 2px solid #333;
    user-select: none;
  }
  .marker {
    position: absolute;
    display: flex;
    align-items: center;
    transform: translate(-50%, -50%);
    cursor: pointer;
    white-space: nowrap;
  }
  .marker-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: red;
    flex-shrink: 0;
    margin-right: 6px;
    border: 1.5px solid white;
  }
  .marker-label {
    color: white;
    font-size: 12px;
    text-shadow: 0 0 2px black;
    user-select: none;
  }
  form {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
  }
  input, select, button {
    padding: 5px;
    font-size: 14px;
  }
  input[type=number] {
    width: 60px;
  }
  input[type=color] {
    width: 40px;
    height: 28px;
    padding: 0;
    border: none;
    background: none;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>90K MAP - 마커 점 + 이름 표시</h1>

<div id="map-container"></div>

<form id="marker-form" autocomplete="off">
  이름: <input type="text" id="name" required />
  X: <input type="number" id="x" min="0" max="600" required />
  Y: <input type="number" id="y" min="0" max="600" required />
  색상: <input type="color" id="color" value="#ff0000" />
  <button type="submit">추가</button>
</form>

<script>
  const map = document.getElementById('map-container');
  const form = document.getElementById('marker-form');

  // 저장된 마커 불러오기
  let markers = JSON.parse(localStorage.getItem('markers') || '[]');

  // 화면에 기존 마커 그리기
  markers.forEach(drawMarker);

  // 마커 추가 폼 이벤트
  form.addEventListener('submit', e => {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const x = parseInt(document.getElementById('x').value);
    const y = parseInt(document.getElementById('y').value);
    const color = document.getElementById('color').value;

    if (x < 0 || x > 600 || y < 0 || y > 600) {
      alert('좌표는 0~600 사이여야 합니다.');
      return;
    }

    // 중복 체크
    if (markers.some(m => m.name === name && m.x === x && m.y === y)) {
      alert('같은 이름과 좌표의 마커가 이미 있습니다.');
      return;
    }

    const markerData = { name, x, y, color };
    markers.push(markerData);
    localStorage.setItem('markers', JSON.stringify(markers));

    drawMarker(markerData);

    form.reset();
  });

  // 지도 클릭시 좌표 자동 입력
  map.addEventListener('click', e => {
    const rect = map.getBoundingClientRect();
    const x = Math.floor(e.clientX - rect.left);
    const y = Math.floor(e.clientY - rect.top);
    if (x >= 0 && x <= 600 && y >= 0 && y <= 600) {
      document.getElementById('x').value = x;
      document.getElementById('y').value = y;
    }
  });

  function drawMarker({ name, x, y, color }) {
    const marker = document.createElement('div');
    marker.className = 'marker';
    marker.style.left = x + 'px';
    marker.style.top = y + 'px';

    const dot = document.createElement('div');
    dot.className = 'marker-dot';
    dot.style.backgroundColor = color;

    const label = document.createElement('span');
    label.className = 'marker-label';
    label.textContent = name;

    marker.appendChild(dot);
    marker.appendChild(label);

    marker.title = '클릭하면 삭제됩니다';

    marker.addEventListener('click', () => {
      if (confirm(`'${name}' 마커를 삭제할까요?`)) {
        marker.remove();
        markers = markers.filter(m => !(m.name === name && m.x === x && m.y === y));
        localStorage.setItem('markers', JSON.stringify(markers));
      }
    });

    map.appendChild(marker);
  }
</script>

</body>
</html>
